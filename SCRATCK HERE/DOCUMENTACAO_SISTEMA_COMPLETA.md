# üìã Documenta√ß√£o Completa: Rotas, Endpoints, Tabelas e Relacionamentos

## üìñ √çndice

1. [Rotas e Endpoints](#rotas-e-endpoints)
2. [Tabelas do Banco de Dados](#tabelas-do-banco-de-dados)
3. [Relacionamentos entre Tabelas](#relacionamentos-entre-tabelas)
4. [Fluxos de Dados por M√≥dulo](#fluxos-de-dados-por-m%C3%B3dulo)

---

## üîó 1. Rotas e Endpoints

### 1.1 üîê Autentica√ß√£o (/api/auth)

| Rota | Endpoint | M√©todo | Descri√ß√£o | Tabelas Envolvidas |
|------|----------|--------|-----------|-------------------|
| Login | `/api/login` | POST | Autentica√ß√£o de usu√°rio e cria√ß√£o de token | Usuario |
| Login | `/api/token` | POST | Autentica√ß√£o alternativa com formul√°rio | Usuario |
| Logout | `/api/logout` | POST | Encerrar sess√£o | - |
| Cadastro | `/api/register` | POST | Registrar novo usu√°rio | Usuario, Setor, Departamento |
| Trocar senha | `/api/change-password` | PUT | Alterar senha do usu√°rio | Usuario |
| Meus dados | `/api/me` | GET | Obter dados do usu√°rio logado | Usuario, Setor, Departamento |
| Debug usuarios | `/api/debug-users` | POST | Debug de usu√°rios (desenvolvimento) | Usuario |
| Test login | `/api/test-login/{user_email}` | POST | Login autom√°tico para testes | Usuario |

### 1.2 üìä PCP (Plano e Controle de Produ√ß√£o) (/api/pcp)

| Rota | Endpoint | M√©todo | Descri√ß√£o | Tabelas Envolvidas |
|------|----------|--------|-----------|-------------------|
| Test | `/api/pcp/test` | GET | Teste de endpoint PCP | - |
| Ordens de servi√ßo | `/api/pcp/ordens-servico` | GET | Listar OS para PCP | OrdemServico, Setor, Departamento |
| Dados formul√°rio | `/api/pcp/programacao-form-data` | GET | Obter dados para formul√°rio de programa√ß√£o | Setor, Usuario, Departamento, OrdemServico, Cliente, Equipamento |
| Supervisores por setor | `/api/pcp/supervisores-por-setor/{setor_id}` | GET | Buscar supervisores de um setor | Usuario, Setor, Departamento |
| Criar programa√ß√£o | `/api/pcp/programacoes` | POST | Criar nova programa√ß√£o | Programacao, OrdemServico, Usuario, Setor, Departamento |
| Listar programa√ß√µes | `/api/pcp/programacoes` | GET | Obter programa√ß√µes | Programacao, OrdemServico, Usuario, Setor, Cliente, Equipamento |
| Dashboard avan√ßado | `/api/pcp/dashboard/avancado` | GET | Dashboard avan√ßado do PCP | Programacao, OrdemServico |
| Alertas | `/api/pcp/alertas` | GET | Alertas do PCP | - |
| Pend√™ncias | `/api/pcp/pendencias` | GET | Pend√™ncias do PCP | Pendencia, Usuario, OrdemServico, ApontamentoDetalhado, Cliente, Equipamento |
| Pend√™ncias dashboard | `/api/pcp/pendencias/dashboard` | GET | Dashboard de pend√™ncias | Pendencia, ApontamentoDetalhado |
| Atribuir programa√ß√£o | `/api/pcp/programacoes/atribuir` | POST | Atribuir programa√ß√£o | Programacao, Usuario, Setor, Departamento |
| Editar programa√ß√£o | `/api/pcp/programacoes/{programacao_id}` | PUT | Editar programa√ß√£o | Programacao, Usuario |
| Reatribuir programa√ß√£o | `/api/pcp/programacoes/{programacao_id}/reatribuir` | PATCH | Reatribuir programa√ß√£o | Programacao, Usuario |
| Atribuir m√∫ltiplos | `/api/pcp/programacoes/{programacao_id}/atribuir-multiplos` | POST | Atribuir para m√∫ltiplos | Programacao, Usuario |
| Cancelar programa√ß√£o | `/api/pcp/programacoes/{programacao_id}` | DELETE | Cancelar programa√ß√£o | Programacao |
| Atualizar status | `/api/pcp/programacoes/{programacao_id}/status` | PATCH | Atualizar status | Programacao |
| Enviar para setor | `/api/pcp/programacoes/{programacao_id}/enviar-setor` | POST | Enviar para setor | Programacao |

### 1.3 üõ†Ô∏è Desenvolvimento (/api/desenvolvimento)

| Rota | Endpoint | M√©todo | Descri√ß√£o | Tabelas Envolvidas |
|------|----------|--------|-----------|-------------------|
| Get setores admin | `/api/desenvolvimento/admin/setores` | GET | Obter setores para admin | Setor |
| Setor configura√ß√£o | `/api/desenvolvimento/setores/{setor_id}/configuracao` | GET | Configura√ß√£o do setor | Setor |
| Categorias m√°quina | `/api/desenvolvimento/admin/categorias-maquina` | GET | Categorias de m√°quina | TipoMaquina |
| Subcategorias por categoria | `/api/desenvolvimento/subcategorias-por-categoria` | GET | Subcategorias por categoria | - |
| Categoria por nome | `/api/desenvolvimento/tipos-maquina/categoria-por-nome` | GET | Categoria por nome tipo | TipoMaquina |
| Subcategorias tipos m√°quina | `/api/desenvolvimento/tipos-maquina/subcategorias` | GET | Subcategorias de tipos m√°quina | TipoMaquina |
| Apontamentos | `/api/desenvolvimento/apontamentos` | GET | Obter apontamentos | ApontamentoDetalhado, OrdemServico, Usuario, Cliente, Equipamento, TipoMaquina, TipoAtividade, TipoDescricaoAtividade |
| Meus apontamentos | `/api/desenvolvimento/os/apontamentos/meus` | GET | Meus apontamentos | ApontamentoDetalhado, Usuario |
| Criar apontamento | `/api/desenvolvimento/os/apontamentos` | POST | Criar apontamento | ApontamentoDetalhado, OrdemServico, Usuario, TipoMaquina, TipoAtividade, TipoDescricaoAtividade, Cliente, Equipamento, TipoCausaRetrabalho, Pendencia |
| Deletar minhas OS | `/api/desenvolvimento/minhas-os` | DELETE | Deletar OS | ApontamentoDetalhado |
| Aprovar apontamento | `/api/desenvolvimento/apontamentos/{apontamento_id}/aprovar` | PUT | Aprovar apontamento | ApontamentoDetalhado, Programacao, Usuario |
| Rejeitar apontamento | `/api/desenvolvimento/apontamentos/{apontamento_id}/rejeitar` | PUT | Rejeitar apontamento | ApontamentoDetalhado, Usuario |
| Finalizar apontamento | `/api/desenvolvimento/apontamentos/{apontamento_id}/finalizar` | PATCH | Finalizar apontamento | ApontamentoDetalhado, Programacao, Pendencia |
| Editar apontamento | `/api/desenvolvimento/apontamentos/{apontamento_id}/editar` | PUT | Editar apontamento | ApontamentoDetalhado |
| Tipos m√°quina formul√°rio | `/api/desenvolvimento/formulario/tipos-maquina` | GET | Tipos m√°quina para formul√°rio | TipoMaquina |
| Atividades por tipo m√°quina | `/api/desenvolvimento/formulario/atividades/{tipo_maquina_id}` | GET | Atividades por tipo m√°quina | TipoTeste |
| Causas retrabalho | `/api/desenvolvimento/formulario/causas-retrabalho` | GET | Causas retrabalho | TipoCausaRetrabalho |
| Tipos atividade | `/api/desenvolvimento/formulario/tipos-atividade` | GET | Tipos atividade | TipoAtividade |
| Descri√ß√µes atividade | `/api/desenvolvimento/formulario/descricoes-atividade` | GET | Descri√ß√µes atividade | TipoDescricaoAtividade |
| Buscar IDs OS | `/api/desenvolvimento/buscar-ids-os` | POST | Buscar IDs das OS | OrdemServico, Cliente, Equipamento |
| Teste simples | `/api/desenvolvimento/formulario/teste-simples/{numero_os}` | GET | Teste scraping simples | - |
| Teste scraping | `/api/desenvolvimento/formulario/teste-scraping/{numero_os}` | GET | Teste scraping com logs | - |
| **Buscar OS ass√≠ncrono** | `/api/desenvolvimento/buscar-os-async/{numero_os}` | POST | **Scraping ass√≠ncrono com Celery** | OrdemServico, Cliente, Equipamento |
| **Status scraping** | `/api/desenvolvimento/scraping-status/{task_id}` | GET | **Status da task ass√≠ncrona** | - |
| **Status fila** | `/api/desenvolvimento/queue-status` | GET | **Status da fila Celery/Redis** | - |
| Buscar OS formul√°rio | `/api/desenvolvimento/formulario/buscar-os/{numero_os}` | GET | Buscar OS para formul√°rio | OrdemServico, Cliente, Equipamento |
| Programa√ß√£o | `/api/desenvolvimento/programacao` | GET | Obter programa√ß√£o | Programacao, OrdemServico, Usuario, Setor, Departamento |
| Colaboradores | `/api/desenvolvimento/colaboradores` | GET | Buscar colaboradores | Usuario, Setor |
| Pend√™ncias | `/api/desenvolvimento/pendencias` | GET | Obter pend√™ncias | Pendencia, ApontamentoDetalhado, Usuario, Setor, Equipamento, OrdemServico |
| Resolver pend√™ncia | `/api/desenvolvimento/pendencias/{pendencia_id}/resolver` | PATCH | Resolver pend√™ncia | Pendencia, Usuario |
| Programa√ß√µes lista | `/api/desenvolvimento/programacoes-lista` | GET | Listar programa√ß√µes | Programacao, OrdemServico, Usuario |
| Alertas | `/api/desenvolvimento/alertas` | GET | Alertas do usu√°rio | Programacao, Usuario |
| Minhas programa√ß√µes | `/api/desenvolvimento/minhas-programacoes` | GET | Minhas programa√ß√µes | Programacao, OrdemServico, Usuario, Cliente, Equipamento |
| Verificar programa√ß√£o OS | `/api/desenvolvimento/verificar-programacao-os/{os_numero}` | GET | Verificar programa√ß√£o por OS | Programacao, OrdemServico, Usuario |
| Finalizar atividade | `/api/desenvolvimento/finalizar-atividade` | POST | Finalizar atividade | Programacao |
| Finalizar programa√ß√£o | `/api/desenvolvimento/finalizar-programacao` | POST | Finalizar programa√ß√£o | Programacao, OrdemServico |
| Criar programa√ß√£o | `/api/desenvolvimento/programacao` | POST | Criar programa√ß√£o | Programacao, OrdemServico, Usuario, Setor, Departamento |
| Finalizar programa√ß√£o (patch) | `/api/desenvolvimento/programacao/{programacao_id}/finalizar` | PATCH | Finalizar programa√ß√£o | Programacao |
| Criar notifica√ß√£o | `/api/desenvolvimento/notificacoes` | POST | Criar notifica√ß√£o | - |

### 1.4 üìã OS (Ordens de Servi√ßo) (/api/os)

| Rota | Endpoint | M√©todo | Descri√ß√£o | Tabelas Envolvidas |
|------|----------|--------|-----------|-------------------|
| Listar OS | `/api/os/` | GET | Listar ordens de servi√ßo | OrdemServico, ApontamentoDetalhado, Usuario, Setor, Cliente, Equipamento, Pendencia |
| Obter OS | `/api/os/{os_id}` | GET | Obter detalhes da OS | OrdemServico, Cliente, TipoMaquina |
| Status summary | `/api/os/{os_id}/status-summary` | GET | Resumo de status da OS | OrdemServico |
| Atualizar status setor | `/api/os/{os_id}/status-setor` | POST | Atualizar status do setor | OrdemServico |
| Listar apontamentos | `/api/os/{os_id}/apontamentos` | GET | Listar apontamentos da OS | ApontamentoDetalhado |
| Dashboard geral | `/api/os/dashboard/geral` | GET | Dashboard geral do sistema | OrdemServico, ApontamentoDetalhado, Usuario, Pendencia |

### 1.5 üë§ Usu√°rios (/api/users)

| Rota | Endpoint | M√©todo | Descri√ß√£o | Tabelas Envolvidas |
|------|----------|--------|-----------|-------------------|
| Listar usu√°rios | `/api/users/usuarios/` | GET | Listar usu√°rios aprovados | Usuario, Setor, Departamento |
| Usu√°rios root | `/api/users/` | GET | Listar todos usu√°rios | Usuario |
| Usu√°rios pendentes | `/api/users/pending-approval` | GET | Usu√°rios pendentes aprova√ß√£o | Usuario |
| Usu√°rios pendentes alt | `/api/users/usuarios/pendentes/` | GET | Usu√°rios pendentes (alternativo) | Usuario |
| Aprovar usu√°rio | `/api/users/usuarios/{user_id}/approve` | PUT | Aprovar usu√°rio | Usuario |
| Rejeitar usu√°rio | `/api/users/usuarios/{user_id}/reject` | PUT | Rejeitar usu√°rio | Usuario |
| Criar usu√°rio | `/api/users/create-user` | POST | Criar novo usu√°rio | Usuario |

### 1.6 üë®‚Äçüíº Administrador (/api/admin)

| Rota | Endpoint | M√©todo | Descri√ß√£o | Tabelas Envolvidas |
|------|----------|--------|-----------|-------------------|
| Dashboard | `/api/admin/dashboard` | GET | Dashboard administrativo | Usuario, OrdemServico, ApontamentoDetalhado, Pendencia, Programacao |
| Usu√°rios | `/api/admin/usuarios` | GET | Listar todos os usu√°rios | Usuario |
| Aprovar usu√°rio | `/api/admin/usuarios/{usuario_id}/aprovar` | POST | Aprovar usu√°rio | Usuario |
| Reprovar usu√°rio | `/api/admin/usuarios/{usuario_id}/reprovar` | POST | Reprovar usu√°rio | Usuario |
| Editar usu√°rio | `/api/admin/usuarios/{usuario_id}` | PUT | Editar usu√°rio | Usuario |
| Deletar usu√°rio | `/api/admin/usuarios/{usuario_id}` | DELETE | Deletar usu√°rio | Usuario |
| Setores | `/api/admin/setores` | GET | Listar setores | Setor |
| Departamentos | `/api/admin/departamentos` | GET | Listar departamentos | Departamento |
| Tipos m√°quina | `/api/admin/tipos-maquina` | GET | Listar tipos de m√°quina | TipoMaquina |
| Tipos atividade | `/api/admin/tipos-atividade` | GET | Listar tipos de atividade | TipoAtividade |
| Tipos teste | `/api/admin/tipos-teste` | GET | Listar tipos de teste | TipoTeste |
| Causas retrabalho | `/api/admin/causas-retrabalho` | GET | Listar causas retrabalho | TipoCausaRetrabalho |
| Pend√™ncias | `/api/admin/pendencias` | GET | Listar todas pend√™ncias | Pendencia, ApontamentoDetalhado, Usuario |
| Resolu√ß√£o pend√™ncias | `/api/admin/pendencias/{id}/resolver` | PATCH | Resolver pend√™ncia | Pendencia |
| Programa√ß√µes | `/api/admin/programacoes` | GET | Listar todas programa√ß√µes | Programacao, OrdemServico, Usuario, Setor |
| Editar programa√ß√£o | `/api/admin/programacoes/{id}` | PUT | Editar programa√ß√£o | Programacao |
| Relat√≥rios | `/api/admin/relatorios` | GET | Acessar relat√≥rios | OrdemServico, ApontamentoDetalhado, Usuario, Pendencia, Programacao |

### 1.7 ‚öôÔ∏è Configura√ß√£o Admin (/api/admin/config)

| Rota | Endpoint | M√©todo | Descri√ß√£o | Tabelas Envolvidas |
|------|----------|--------|-----------|-------------------|
| Departamentos | `/api/admin/config/departamento` | GET/POST | Gerenciar departamentos | Departamento |
| Setores | `/api/admin/config/setor` | GET/POST/PUT/DELETE | Gerenciar setores | Setor, Departamento |
| Tipos m√°quina | `/api/admin/config/tipos-maquina` | GET/POST/PUT/DELETE | Gerenciar tipos de m√°quina | TipoMaquina |
| Tipos teste | `/api/admin/config/tipos-teste` | GET/POST/PUT/DELETE | Gerenciar tipos de teste | TipoTeste |
| Atividades | `/api/admin/config/atividades` | GET/POST/PUT/DELETE | Gerenciar atividades | TipoAtividade |
| Descri√ß√µes atividades | `/api/admin/config/descricoes-atividade` | GET/POST/PUT/DELETE | Gerenciar descri√ß√µes atividades | TipoDescricaoAtividade |
| Tipos falha | `/api/admin/config/tipos-falha` | GET/POST/PUT/DELETE | Gerenciar tipos de falha | TipoFalha |
| Causas retrabalho | `/api/admin/config/causas-retrabalho` | GET/POST/PUT/DELETE | Gerenciar causas retrabalho | TipoCausaRetrabalho |
| Estrutura hier√°rquica | `/api/admin/config/estrutura-hierarquica` | GET/POST | Gerenciar estrutura hier√°rquica | Departamento, Setor, Usuario |

### 1.8 üìà Gest√£o (/api/gestao)

| Rota | Endpoint | M√©todo | Descri√ß√£o | Tabelas Envolvidas |
|------|----------|--------|-----------|-------------------|
| Dashboard | `/api/gestao/dashboard` | GET | Dashboard de gest√£o | OrdemServico, ApontamentoDetalhado, Usuario, Pendencia, Programacao, Setor, Departamento |
| Relat√≥rios | `/api/gestao/relatorios` | GET | Relat√≥rios de gest√£o | OrdemServico, ApontamentoDetalhado, Usuario, Pendencia, Programacao |
| Aprova√ß√µes | `/api/gestao/aprovacoes` | GET | Tarefas de aprova√ß√£o | ApontamentoDetalhado, Programacao, Usuario |
| M√©tricas | `/api/gestao/metricas` | GET | M√©tricas de gest√£o | OrdemServico, ApontamentoDetalhado, Usuario, Pendencia, Programacao, Setor, Departamento |
| Auditoria | `/api/gestao/auditoria` | GET | Logs de auditoria | Usuario, OrdemServico, ApontamentoDetalhado, Programacao, Pendencia |

### 1.9 üìä Relat√≥rios (/api/relatorio-completo)

| Rota | Endpoint | M√©todo | Descri√ß√£o | Tabelas Envolvidas |
|------|----------|--------|-----------|-------------------|
| Relat√≥rio completo | `/api/relatorio-completo` | GET | Relat√≥rio completo | OrdemServico, ApontamentoDetalhado, Usuario, Pendencia, Programacao, Setor, Departamento, Cliente, Equipamento, TipoMaquina, TipoAtividade, TipoDescricaoAtividade, TipoCausaRetrabalho, TipoTeste |
| Exportar PDF | `/api/relatorio-completo/export/pdf` | GET | Exportar relat√≥rio em PDF | Todas as tabelas |
| Exportar Excel | `/api/relatorio-completo/export/excel` | GET | Exportar relat√≥rio em Excel | Todas as tabelas |

### 1.10 üåê Global (/api)

| Rota | Endpoint | M√©todo | Descri√ß√£o | Tabelas Envolvidas |
|------|----------|--------|-----------|-------------------|
| Root | `/` | GET | API status | - |
| Health | `/health` | GET | Health check | - |
| Health general | `/api/health` | GET | Health check geral | - |
| Test endpoint | `/api/test-endpoint` | GET | Endpoint de teste | - |
| Check access | `/api/check-development-access/{sector}` | GET | Verificar acesso ao setor | Usuario |
| Save apontamento | `/api/save-apontamento` | POST | Salvar apontamento | ApontamentoDetalhado, OrdemServico, Usuario |
| Save com pend√™ncia | `/api/save-apontamento-with-pendencia` | POST | Salvar apontamento com pend√™ncia | ApontamentoDetalhado, Pendencia, OrdemServico, Usuario |
| Listar pend√™ncias | `/api/pendencias` | GET | Listar pend√™ncias | Pendencia, Usuario |
| Atualizar pend√™ncia | `/api/pendencias/{pendencia_id}` | PUT | Atualizar pend√™ncia | Pendencia, Usuario |
| Meus apontamentos | `/api/os/apontamentos/meus` | GET | Meus apontamentos | ApontamentoDetalhado, OrdemServico, Usuario |
| Listar OS | `/api/os/` | GET | Listar ordens de servi√ßo | OrdemServico, Cliente, Equipamento, Usuario |
| User info | `/api/user-info` | GET | Informa√ß√µes do usu√°rio | Usuario, Setor, Departamento |
| Scraping OS | `/api/scraping/consulta-os` | POST | Consultar OS via scraping | OrdemServico, Cliente, Equipamento |
| Categorias m√°quina | `/api/tipos-maquina/categorias` | GET | Categorias de m√°quina | TipoMaquina |
| Programa√ß√£o testes | `/api/programacao-testes` | GET | Listar programa√ß√£o testes | Programacao, OrdemServico |
| Status programa√ß√£o | `/api/programacao-testes/{programacao_id}/status` | PUT | Atualizar status programa√ß√£o | Programacao |
| Relat√≥rio apontamento | `/api/apontamentos/{apontamento_id}/relatorio-completo` | GET | Relat√≥rio completo apontamento | ApontamentoDetalhado, OrdemServico, Usuario |
| Ordens servi√ßo globais | `/api/ordens-servico` | GET | OS globais simplificadas | OrdemServico |
| Programa√ß√µes globais | `/api/programacoes` | GET | Programa√ß√µes globais simplificadas | Programacao |
| Apontamentos detalhados | `/api/apontamentos-detalhados` | GET | Apontamentos detalhados | ApontamentoDetalhado, Usuario, OrdemServico, Cliente, Equipamento |

### 1.11 üìö Cat√°logos (/api)

| Rota | Endpoint | M√©todo | Descri√ß√£o | Tabelas Envolvidas |
|------|----------|--------|-----------|-------------------|
| Departamentos | `/api/departamentos` | GET | Listar departamentos | Departamento |
| Setores | `/api/setores` | GET | Listar setores | Setor, Departamento |
| Estrutura hier√°rquica | `/api/estrutura-hierarquica` | GET | Estrutura completa | Departamento, Setor, TipoMaquina, TipoAtividade |
| Tipos m√°quina | `/api/tipos-maquina` | GET | Listar tipos de m√°quina | TipoMaquina, Departamento |
| Tipos teste | `/api/tipos-teste` | GET | Listar tipos de teste | TipoTeste |
| Tipos teste valores | `/api/tipos-teste-valores` | GET | Valores √∫nicos tipo teste | TipoTeste |
| Clientes | `/api/clientes` | GET | Listar clientes | Cliente |
| Equipamentos | `/api/equipamentos` | GET | Listar equipamentos | Equipamento |
| Usu√°rios | `/api/usuarios` | GET | Listar usu√°rios | Usuario, Setor, Departamento |
| Tipo atividade | `/api/tipo-atividade` | GET | Listar tipos atividade | TipoAtividade, Departamento |
| Descri√ß√£o atividade | `/api/descricao-atividade` | GET | Listar descri√ß√µes atividade | TipoDescricaoAtividade, Departamento |
| Tipo falha | `/api/tipo-falha` | GET | Listar tipos falha | TipoFalha |
| Causas retrabalho | `/api/causas-retrabalho` | GET | Listar causas retrabalho | TipoCausaRetrabalho |
| Ordens servi√ßo | `/api/ordens-servico` | GET | Listar ordens servi√ßo | OrdemServico, Cliente, Equipamento |
| Status cat√°logos | `/api/status` | GET | Status dos cat√°logos | - |
| Health cat√°logos | `/api/health` | GET | Health check cat√°logos | - |

---

## üóÑÔ∏è 2. Tabelas do Banco de Dados

### 2.1 üè∑Ô∏è Tabela Principal - OrdemServico

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| os_numero | String | N√∫mero da OS | - |
| status_os | String | Status da OS | - |
| prioridade | String | Prioridade (ALTA, MEDIA, BAIXA) | - |
| id_responsavel_registro | Integer | Respons√°vel pelo registro | Usuario |
| id_responsavel_pcp | Integer | Respons√°vel PCP | Usuario |
| id_responsavel_final | Integer | Respons√°vel final | Usuario |
| data_inicio_prevista | DateTime | Data in√≠cio prevista | - |
| data_fim_prevista | DateTime | Data fim prevista | - |
| data_criacao | DateTime | Data de cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |
| criado_por | Integer | Criado por | Usuario |
| status_geral | String | Status geral | - |
| valor_total_previsto | Decimal | Valor total previsto | - |
| valor_total_real | Decimal | Valor total real | - |
| observacoes_gerais | Text | Observa√ß√µes gerais | - |
| id_tipo_maquina | Integer | ID tipo m√°quina | TipoMaquina |
| custo_total_real | Decimal | Custo total real | - |
| horas_previstas | Decimal | Horas previstas | - |
| horas_reais | Decimal | Horas reais | - |
| data_programacao | DateTime | Data programa√ß√£o | - |
| horas_orcadas | Decimal | Horas or√ßadas | - |
| testes_iniciais_finalizados | Boolean | Testes iniciais finalizados | - |
| testes_parciais_finalizados | Boolean | Testes parciais finalizados | - |
| testes_finais_finalizados | Boolean | Testes finais finalizados | - |
| data_testes_iniciais_finalizados | DateTime | Data testes iniciais | - |
| data_testes_parciais_finalizados | DateTime | Data testes parciais | - |
| data_testes_finais_finalizados | DateTime | Data testes finais | - |
| id_usuario_testes_iniciais | Integer | Usu√°rio testes iniciais | Usuario |
| id_usuario_testes_parciais | Integer | Usu√°rio testes parciais | Usuario |
| id_usuario_testes_finais | Integer | Usu√°rio testes finais | Usuario |
| testes_exclusivo_os | Text | Testes exclusivos da OS | - |
| id_cliente | Integer | ID cliente | Cliente |
| id_equipamento | Integer | ID equipamento | Equipamento |
| id_setor | Integer | ID setor | Setor |
| id_departamento | Integer | ID departamento | Departamento |
| inicio_os | DateTime | In√≠cio da OS | - |
| fim_os | DateTime | Fim da OS | - |
| descricao_maquina | Text | Descri√ß√£o da m√°quina | - |

### 2.2 ‚è±Ô∏è Tabela - ApontamentoDetalhado

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| id_os | Integer | ID da OS | OrdemServico |
| id_usuario | Integer | ID do usu√°rio | Usuario |
| id_setor | Integer | ID do setor | Setor |
| data_hora_inicio | DateTime | Data/hora in√≠cio | - |
| data_hora_fim | DateTime | Data/hora fim | - |
| status_apontamento | String | Status do apontamento | - |
| foi_retrabalho | Boolean | Foi retrabalho | - |
| causa_retrabalho | Integer | ID causa retrabalho | TipoCausaRetrabalho |
| observacao_os | Text | Observa√ß√£o OS | - |
| servico_de_campo | Boolean | Servi√ßo de campo | - |
| observacoes_gerais | Text | Observa√ß√µes gerais | - |
| aprovado_supervisor | Boolean | Aprovado supervisor | - |
| data_aprovacao_supervisor | DateTime | Data aprova√ß√£o supervisor | - |
| supervisor_aprovacao | Integer | ID supervisor aprova√ß√£o | Usuario |
| criado_por | Integer | Criado por | Usuario |
| criado_por_email | String | Email criado por | - |
| data_processo_finalizado | DateTime | Data processo finalizado | - |
| setor | String | Setor (compatibilidade) | - |
| horas_orcadas | Decimal | Horas or√ßadas | - |
| etapa_inicial | Boolean | Etapa inicial | - |
| etapa_parcial | Boolean | Etapa parcial | - |
| etapa_final | Boolean | Etapa final | - |
| horas_etapa_inicial | Decimal | Horas etapa inicial | - |
| horas_etapa_parcial | Decimal | Horas etapa parcial | - |
| horas_etapa_final | Decimal | Horas etapa final | - |
| observacoes_etapa_inicial | Text | Observa√ß√µes etapa inicial | - |
| observacoes_etapa_parcial | Text | Observa√ß√µes etapa parcial | - |
| observacoes_etapa_final | Text | Observa√ß√µes etapa final | - |
| data_etapa_inicial | DateTime | Data etapa inicial | - |
| data_etapa_parcial | DateTime | Data etapa parcial | - |
| data_etapa_final | DateTime | Data etapa final | - |
| supervisor_etapa_inicial | Integer | Supervisor etapa inicial | Usuario |
| supervisor_etapa_parcial | Integer | Supervisor etapa parcial | Usuario |
| supervisor_etapa_final | Integer | Supervisor etapa final | Usuario |
| tipo_maquina | Integer | ID tipo m√°quina | TipoMaquina |
| tipo_atividade | Integer | ID tipo atividade | TipoAtividade |
| descricao_atividade | Integer | ID descri√ß√£o atividade | TipoDescricaoAtividade |
| **categoria_maquina** | **String** | **Categoria m√°quina** | **-** |
| **subcategorias_maquina** | **Text** | **Subcategorias m√°quina** | **-** |
| **subcategorias_finalizadas** | **Boolean** | **Subcategorias finalizadas** | **-** |
| **data_finalizacao_subcategorias** | **DateTime** | **Data finaliza√ß√£o subcategorias** | **-** |
| **emprestimo_setor** | **String** | **Empr√©stimo setor** | **-** |
| **pendencia** | **Boolean** | **Pend√™ncia** | **-** |
| **pendencia_data** | **DateTime** | **Data pend√™ncia** | **-** |
| **resultado_global** | **String** | **Resultado global** | **-** |

### 2.3 üö® Tabela - Pendencia

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| numero_os | String | N√∫mero da OS | OrdemServico |
| cliente | String | Cliente | - |
| data_inicio | DateTime | Data in√≠cio | - |
| id_responsavel_inicio | Integer | ID respons√°vel in√≠cio | Usuario |
| tipo_maquina | String | Tipo m√°quina | - |
| descricao_maquina | Text | Descri√ß√£o m√°quina | - |
| descricao_pendencia | Text | Descri√ß√£o pend√™ncia | - |
| status | String | Status (ABERTA, FECHADA) | - |
| prioridade | String | Prioridade | - |
| data_fechamento | DateTime | Data fechamento | - |
| id_responsavel_fechamento | Integer | ID respons√°vel fechamento | Usuario |
| solucao_aplicada | Text | Solu√ß√£o aplicada | - |
| observacoes_fechamento | Text | Observa√ß√µes fechamento | - |
| id_apontamento_origem | Integer | ID apontamento origem | ApontamentoDetalhado |
| id_apontamento_fechamento | Integer | ID apontamento fechamento | ApontamentoDetalhado |
| tempo_aberto_horas | Float | Tempo aberto horas | - |
| data_criacao | DateTime | Data cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |
| setor_origem | String | Setor origem | - |
| departamento_origem | String | Departamento origem | - |

### 2.4 üìÖ Tabela - Programacao

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| id_ordem_servico | Integer | ID ordem servi√ßo | OrdemServico |
| criado_por_id | Integer | Criado por | Usuario |
| responsavel_id | Integer | Respons√°vel | Usuario |
| observacoes | Text | Observa√ß√µes | - |
| historico | Text | Hist√≥rico | - |
| status | String | Status | - |
| inicio_previsto | DateTime | In√≠cio previsto | - |
| fim_previsto | DateTime | Fim previsto | - |
| created_at | DateTime | Criado em | - |
| updated_at | DateTime | Atualizado em | - |
| id_setor | Integer | ID setor | Setor |

### 2.5 ‚úÖ Tabela - ResultadoTeste

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| id_apontamento | Integer | ID apontamento | ApontamentoDetalhado |
| id_teste | Integer | ID teste | TipoTeste |
| resultado | String | Resultado | - |
| observacao | Text | Observa√ß√£o | - |
| data_registro | DateTime | Data registro | - |

### 2.6 üß™ Tabela - OSTestesExclusivosFinalizados

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| numero_os | String | N√∫mero OS | OrdemServico |
| id_teste_exclusivo | Integer | ID teste exclusivo | TipoTeste |
| nome_teste | String | Nome teste | - |
| descricao_teste | String | Descri√ß√£o teste | - |
| usuario_finalizacao | Integer | Usu√°rio finaliza√ß√£o | Usuario |
| departamento | String | Departamento | - |
| setor | String | Setor | - |
| data_finalizacao | Date | Data finaliza√ß√£o | - |
| hora_finalizacao | Time | Hora finaliza√ß√£o | - |
| descricao_atividade | Text | Descri√ß√£o atividade | - |
| observacoes | Text | Observa√ß√µes | - |
| data_criacao | DateTime | Data cria√ß√£o | - |

### 2.7 ü§ù Tabela Referencial - Cliente

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| razao_social | String | Raz√£o social | - |
| nome_fantasia | String | Nome fantasia | - |
| cnpj_cpf | String | CNPJ/CPF | - |
| contato_principal | String | Contato principal | - |
| telefone_contato | String | Telefone contato | - |
| email_contato | String | Email contato | - |
| endereco | Text | Endere√ßo | - |
| data_criacao | DateTime | Data cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |

### 2.8 üõ†Ô∏è Tabela Referencial - Equipamento

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| descricao | Text | Descri√ß√£o | - |
| tipo | String | Tipo | - |
| fabricante | String | Fabricante | - |
| modelo | String | Modelo | - |
| numero_serie | String | N√∫mero s√©rie | - |
| data_criacao | DateTime | Data cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |

### 2.9 üë§ Tabela Referencial - Usuario (TipoUsuario)

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| nome_completo | String | Nome completo | - |
| nome_usuario | String | Nome usu√°rio | - |
| email | String | Email | - |
| matricula | String | Matr√≠cula | - |
| senha_hash | String | Senha hash | - |
| setor | String | Setor | - |
| cargo | String | Cargo | - |
| departamento | String | Departamento | - |
| privilege_level | String | N√≠vel privil√©gio | - |
| is_approved | Boolean | Aprovado | - |
| data_criacao | DateTime | Data cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |
| trabalha_producao | Boolean | Trabalha produ√ß√£o | - |
| obs_reprovacao | Text | Observa√ß√£o reprova√ß√£o | - |
| id_setor | Integer | ID setor | Setor |
| id_departamento | Integer | ID departamento | Departamento |
| primeiro_login | Boolean | Primeiro login | - |

### 2.10 üèóÔ∏è Tabela Referencial - Setor (TipoSetor)

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| nome | String | Nome | - |
| departamento | String | Departamento | - |
| descricao | Text | Descri√ß√£o | - |
| ativo | Boolean | Ativo | - |
| data_criacao | DateTime | Data cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |
| id_departamento | Integer | ID departamento | Departamento |
| area_tipo | String | √Årea tipo | - |
| supervisor_responsavel | Integer | Supervisor respons√°vel | Usuario |
| permite_apontamento | Boolean | Permite apontamento | - |

### 2.11 üîß Tabela Referencial - TipoMaquina

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| nome_tipo | String | Nome tipo | - |
| categoria | String | Categoria | - |
| **subcategoria** | **JSON** | **Subcategoria (array JSON)** | **-** |
| descricao | Text | Descri√ß√£o | - |
| ativo | Boolean | Ativo | - |
| data_criacao | DateTime | Data cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |
| id_departamento | Integer | ID departamento | Departamento |
| **especificacoes_tecnicas** | **Text** | **Especifica√ß√µes t√©cnicas (compatibilidade)** | **-** |
| **campos_teste_resultado** | **Text** | **Campos teste resultado (compatibilidade)** | **-** |
| **setor** | **String** | **Setor (compatibilidade)** | **-** |
| **departamento** | **Text** | **Departamento (compatibilidade)** | **-** |

### 2.12 üéØ Tabela Referencial - TipoAtividade

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| nome_tipo | String | Nome tipo | - |
| descricao | Text | Descri√ß√£o | - |
| categoria | String | Categoria | - |
| ativo | Boolean | Ativo | - |
| data_criacao | DateTime | Data cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |
| id_tipo_maquina | Integer | ID tipo m√°quina | TipoMaquina |
| id_departamento | Integer | ID departamento | Departamento |
| **departamento** | **String** | **Departamento (compatibilidade)** | **-** |
| **setor** | **String** | **Setor (compatibilidade)** | **-** |

### 2.13 üìù Tabela Referencial - TipoDescricaoAtividade

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| codigo | String | C√≥digo | - |
| descricao | Text | Descri√ß√£o | - |
| categoria | String | Categoria | - |
| ativo | Boolean | Ativo | - |
| data_criacao | DateTime | Data cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |
| **setor** | **String** | **Setor (compatibilidade)** | **-** |
| id_departamento | Integer | ID departamento | Departamento |
| **departamento** | **String** | **Departamento (compatibilidade)** | **-** |
| tipo_maquina | Integer | Tipo m√°quina | TipoMaquina |

### 2.14 üß™ Tabela Referencial - TipoTeste

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| nome | String | Nome | - |
| descricao | Text | Descri√ß√£o | - |
| tipo_teste | String | Tipo teste | - |
| tipo_maquina | String | Tipo m√°quina | - |
| categoria | String | Categoria | - |
| subcategoria | Integer | Subcategoria | - |
| ativo | Boolean | Ativo | - |
| data_criacao | DateTime | Data cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |
| **teste_exclusivo_setor** | **Boolean** | **Teste exclusivo setor** | **-** |
| **descricao_teste_exclusivo** | **Text** | **Descri√ß√£o teste exclusivo** | **-** |

### 2.15 ‚ö†Ô∏è Tabela Referencial - TipoCausaRetrabalho

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| nome_tipo | String | Nome tipo | - |
| descricao | Text | Descri√ß√£o | - |
| categoria | String | Categoria | - |
| ativo | Boolean | Ativo | - |
| data_criacao | DateTime | Data cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |

### 2.16 üö® Tabela Referencial - TipoFalha

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| nome_tipo | String | Nome tipo | - |
| descricao | Text | Descri√ß√£o | - |
| categoria | String | Categoria | - |
| ativo | Boolean | Ativo | - |
| data_criacao | DateTime | Data cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |

### 2.17 üè¢ Tabela Referencial - Departamento (TipoDepartamento)

| Coluna | Tipo | Descri√ß√£o | Relacionamentos |
|--------|------|-----------|-----------------|
| id | Integer | ID prim√°rio | - |
| nome_tipo | String | Nome tipo | - |
| descricao | Text | Descri√ß√£o | - |
| ativo | Boolean | Ativo | - |
| data_criacao | DateTime | Data cria√ß√£o | - |
| data_ultima_atualizacao | DateTime | √öltima atualiza√ß√£o | - |

---

## üîó 3. Relacionamentos entre Tabelas

### 3.1 üè∑Ô∏è Relacionamentos Principais

#### OrdemServico (Tabela Central)
- **Cliente**: `id_cliente` ‚Üí `clientes.id` (Many-to-One)
- **Equipamento**: `id_equipamento` ‚Üí `equipamentos.id` (Many-to-One)
- **TipoMaquina**: `id_tipo_maquina` ‚Üí `tipos_maquina.id` (Many-to-One)
- **Setor**: `id_setor` ‚Üí `tipo_setores.id` (Many-to-One)
- **Departamento**: `id_departamento` ‚Üí `tipo_departamentos.id` (Many-to-One)
- **Usu√°rios Respons√°veis**:
  - `id_responsavel_registro` ‚Üí `tipo_usuarios.id` (Many-to-One)
  - `id_responsavel_pcp` ‚Üí `tipo_usuarios.id` (Many-to-One)
  - `id_responsavel_final` ‚Üí `tipo_usuarios.id` (Many-to-One)
  - `criado_por` ‚Üí `tipo_usuarios.id` (Many-to-One)
- **Usu√°rios Testes**:
  - `id_usuario_testes_iniciais` ‚Üí `tipo_usuarios.id` (Many-to-One)
  - `id_usuario_testes_parciais` ‚Üí `tipo_usuarios.id` (Many-to-One)
  - `id_usuario_testes_finais` ‚Üí `tipo_usuarios.id` (Many-to-One)

#### ApontamentoDetalhado
- **OrdemServico**: `id_os` ‚Üí `ordens_servico.id` (Many-to-One)
- **Usuario**: `id_usuario` ‚Üí `tipo_usuarios.id` (Many-to-One)
- **Setor**: `id_setor` ‚Üí `tipo_setores.id` (Many-to-One)
- **TipoMaquina**: `tipo_maquina` ‚Üí `tipos_maquina.id` (Many-to-One)
- **TipoAtividade**: `tipo_atividade` ‚Üí `tipo_atividade.id` (Many-to-One)
- **TipoDescricaoAtividade**: `descricao_atividade` ‚Üí `tipo_descricao_atividade.id` (Many-to-One)
- **TipoCausaRetrabalho**: `causa_retrabalho` ‚Üí `tipo_causas_retrabalho.id` (Many-to-One)
- **Supervisores**:
  - `supervisor_aprovacao` ‚Üí `tipo_usuarios.id` (Many-to-One)
  - `supervisor_etapa_inicial` ‚Üí `tipo_usuarios.id` (Many-to-One)
  - `supervisor_etapa_parcial` ‚Üí `tipo_usuarios.id` (Many-to-One)
  - `supervisor_etapa_final` ‚Üí `tipo_usuarios.id` (Many-to-One)

#### Pendencia
- **OrdemServico**: `numero_os` ‚Üí `ordens_servico.os_numero` (Many-to-One)
- **Usu√°rios**:
  - `id_responsavel_inicio` ‚Üí `tipo_usuarios.id` (Many-to-One)
  - `id_responsavel_fechamento` ‚Üí `tipo_usuarios.id` (Many-to-One)
- **Apontamentos**:
  - `id_apontamento_origem` ‚Üí `apontamentos_detalhados.id` (Many-to-One)
  - `id_apontamento_fechamento` ‚Üí `apontamentos_detalhados.id` (Many-to-One)

#### Programacao
- **OrdemServico**: `id_ordem_servico` ‚Üí `ordens_servico.id` (Many-to-One)
- **Usu√°rios**:
  - `criado_por_id` ‚Üí `tipo_usuarios.id` (Many-to-One)
  - `responsavel_id` ‚Üí `tipo_usuarios.id` (Many-to-One)
- **Setor**: `id_setor` ‚Üí `tipo_setores.id` (Many-to-One)

### 3.2 üèóÔ∏è Hierarquia Organizacional

#### Departamento ‚Üí Setor ‚Üí Usuario
```
Departamento (tipo_departamentos)
‚îú‚îÄ‚îÄ id, nome_tipo, descricao
‚îî‚îÄ‚îÄ Setor (tipo_setores)
    ‚îú‚îÄ‚îÄ id, nome, id_departamento
    ‚îî‚îÄ‚îÄ Usuario (tipo_usuarios)
        ‚îú‚îÄ‚îÄ id, nome_completo, id_setor, id_departamento
        ‚îî‚îÄ‚îÄ privilege_level: USER, SUPERVISOR, GESTAO, ADMIN, PCP
```

#### Departamento ‚Üí TipoMaquina ‚Üí TipoAtividade
```
Departamento (tipo_departamentos)
‚îú‚îÄ‚îÄ TipoMaquina (tipos_maquina)
‚îÇ   ‚îú‚îÄ‚îÄ id, nome_tipo, categoria, subcategoria
‚îÇ   ‚îî‚îÄ‚îÄ id_departamento
‚îî‚îÄ‚îÄ TipoAtividade (tipo_atividade)
    ‚îú‚îÄ‚îÄ id, nome_tipo, categoria
    ‚îî‚îÄ‚îÄ id_departamento, id_tipo_maquina
```

### 3.3 üîÑ Relacionamentos Reversos

#### OrdemServico (One-to-Many)
- **apontamentos**: `ApontamentoDetalhado.id_os`
- **programacoes**: `Programacao.id_ordem_servico`
- **pendencias**: `Pendencia.numero_os`

#### Usuario (One-to-Many)
- **ordens_criadas**: `OrdemServico.criado_por`
- **ordens_responsavel_registro**: `OrdemServico.id_responsavel_registro`
- **ordens_responsavel_pcp**: `OrdemServico.id_responsavel_pcp`
- **ordens_responsavel_final**: `OrdemServico.id_responsavel_final`
- **apontamentos**: `ApontamentoDetalhado.id_usuario`
- **programacoes_criadas**: `Programacao.criado_por_id`
- **programacoes_responsavel**: `Programacao.responsavel_id`
- **pendencias_inicio**: `Pendencia.id_responsavel_inicio`
- **pendencias_fechamento**: `Pendencia.id_responsavel_fechamento`

#### Setor (One-to-Many)
- **usuarios**: `Usuario.id_setor`
- **ordens_servico**: `OrdemServico.id_setor`
- **apontamentos**: `ApontamentoDetalhado.id_setor`
- **programacoes**: `Programacao.id_setor`

#### Departamento (One-to-Many)
- **setores**: `Setor.id_departamento`
- **usuarios**: `Usuario.id_departamento`
- **tipos_maquina**: `TipoMaquina.id_departamento`
- **tipos_atividade**: `TipoAtividade.id_departamento`
- **descricoes_atividade**: `TipoDescricaoAtividade.id_departamento`

---

## üìä 4. Fluxos de Dados por M√≥dulo

### 4.1 üîê Fluxo de Autentica√ß√£o

```mermaid
graph TD
    A[Login Request] --> B[Verificar Credenciais]
    B --> C{Usu√°rio V√°lido?}
    C -->|Sim| D{Usu√°rio Aprovado?}
    C -->|N√£o| E[Erro 401]
    D -->|Sim| F[Gerar Token JWT]
    D -->|N√£o| G[Erro 403]
    F --> H[Buscar Dados Completos]
    H --> I[Retornar User + Token]
```

**Tabelas Envolvidas:**
1. `tipo_usuarios` - Verifica√ß√£o de credenciais e aprova√ß√£o
2. `tipo_setores` - Dados do setor do usu√°rio
3. `tipo_departamentos` - Dados do departamento do usu√°rio

### 4.2 üìã Fluxo de Cria√ß√£o de OS

```mermaid
graph TD
    A[Dados da OS] --> B[Validar Cliente/Equipamento]
    B --> C[Criar OrdemServico]
    C --> D[Associar TipoMaquina]
    D --> E[Definir Respons√°veis]
    E --> F[Salvar no Banco]
    F --> G[Retornar OS Criada]
```

**Tabelas Envolvidas:**
1. `ordens_servico` - Registro principal
2. `clientes` - Valida√ß√£o do cliente
3. `equipamentos` - Valida√ß√£o do equipamento
4. `tipos_maquina` - Tipo de m√°quina
5. `tipo_usuarios` - Respons√°veis
6. `tipo_setores` - Setor da OS
7. `tipo_departamentos` - Departamento da OS

### 4.3 ‚è±Ô∏è Fluxo de Apontamento

```mermaid
graph TD
    A[Iniciar Apontamento] --> B[Validar OS]
    B --> C[Validar Usu√°rio/Setor]
    C --> D[Registrar In√≠cio]
    D --> E[Trabalhar na OS]
    E --> F[Finalizar Apontamento]
    F --> G{Tem Pend√™ncia?}
    G -->|Sim| H[Criar Pendencia]
    G -->|N√£o| I[Finalizar Normalmente]
    H --> J[Salvar Apontamento + Pend√™ncia]
    I --> K[Salvar Apontamento]
```

**Tabelas Envolvidas:**
1. `apontamentos_detalhados` - Registro do apontamento
2. `ordens_servico` - OS sendo trabalhada
3. `tipo_usuarios` - Usu√°rio executando
4. `tipo_setores` - Setor do apontamento
5. `tipos_maquina` - Tipo de m√°quina
6. `tipo_atividade` - Tipo de atividade
7. `tipo_descricao_atividade` - Descri√ß√£o da atividade
8. `tipo_causas_retrabalho` - Se for retrabalho
9. `pendencias` - Se houver pend√™ncia

### 4.4 üìÖ Fluxo de Programa√ß√£o PCP

```mermaid
graph TD
    A[PCP Acessa Dashboard] --> B[Listar OS Dispon√≠veis]
    B --> C[Selecionar OS]
    C --> D[Escolher Respons√°vel]
    D --> E[Definir Setor]
    E --> F[Criar Programacao]
    F --> G[Notificar Respons√°vel]
    G --> H[Atualizar Status OS]
```

**Tabelas Envolvidas:**
1. `programacoes` - Registro da programa√ß√£o
2. `ordens_servico` - OS sendo programada
3. `tipo_usuarios` - Respons√°vel e criador
4. `tipo_setores` - Setor de destino
5. `tipo_departamentos` - Departamento

### 4.5 üö® Fluxo de Pend√™ncias

```mermaid
graph TD
    A[Detectar Problema] --> B[Criar Pendencia]
    B --> C[Associar Apontamento]
    C --> D[Definir Prioridade]
    D --> E[Notificar Respons√°veis]
    E --> F[Aguardar Resolu√ß√£o]
    F --> G[Aplicar Solu√ß√£o]
    G --> H[Fechar Pendencia]
    H --> I[Atualizar Apontamento]
```

**Tabelas Envolvidas:**
1. `pendencias` - Registro da pend√™ncia
2. `apontamentos_detalhados` - Apontamento origem
3. `ordens_servico` - OS relacionada
4. `tipo_usuarios` - Respons√°veis

---

## üèóÔ∏è 5. Arquitetura e Tecnologias

### 5.1 üîß Stack Tecnol√≥gico

#### Backend
- **Framework**: FastAPI 0.104.1
- **ORM**: SQLAlchemy 2.0+
- **Banco de Dados**: SQLite (registroos_new.db)
- **Autentica√ß√£o**: JWT com HttpOnly Cookies
- **Valida√ß√£o**: Pydantic Models
- **CORS**: Configurado para localhost:3000 e localhost:3001

#### Frontend
- **Framework**: React 18+ com TypeScript
- **Styling**: Tailwind CSS
- **Roteamento**: React Router DOM
- **Estado**: Context API + useState/useEffect
- **HTTP Client**: Fetch API nativo
- **Build**: Vite

#### Banco de Dados
- **Tipo**: SQLite
- **Arquivo**: `registroos_new.db`
- **Localiza√ß√£o**: `RegistroOS/registrooficial/backend/`
- **Migrations**: SQLAlchemy Alembic (quando necess√°rio)

### 5.2 üìÅ Estrutura de Diret√≥rios

```
RegistroOS/
‚îú‚îÄ‚îÄ registrooficial/
‚îÇ   ‚îú‚îÄ‚îÄ backend/                 # API FastAPI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/                # Modelos e depend√™ncias
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database_models.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dependencies.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/             # Endpoints organizados
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pcp_routes.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ desenvolvimento.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin_routes_simple.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin_config_routes.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gestao_routes.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ os_routes_simple.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ general.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ relatorio_completo.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ catalogs_validated_clean.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/             # Configura√ß√µes
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database_config.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/              # Utilit√°rios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scripts/            # Scripts auxiliares
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py             # Aplica√ß√£o principal
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ registroos_new.db   # Banco SQLite
‚îÇ   ‚îî‚îÄ‚îÄ frontend/               # Interface React
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ components/     # Componentes reutiliz√°veis
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ features/       # Funcionalidades por m√≥dulo
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pcp/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ desenvolvimento/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ gestao/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ services/       # APIs e servi√ßos
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ contexts/       # Context providers
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ hooks/          # Custom hooks
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ types/          # TypeScript types
‚îÇ       ‚îú‚îÄ‚îÄ public/
‚îÇ       ‚îî‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ SCRATCK HERE/               # Testes e documenta√ß√£o
```

### 5.3 üîê Seguran√ßa e Autentica√ß√£o

#### N√≠veis de Privil√©gio
1. **USER** - Usu√°rio b√°sico (apontamentos)
2. **SUPERVISOR** - Supervisor de setor (aprova√ß√µes)
3. **GESTAO** - Gest√£o (relat√≥rios e m√©tricas)
4. **PCP** - Planejamento e Controle (programa√ß√µes)
5. **ADMIN** - Administrador (configura√ß√µes)

#### Fluxo de Autentica√ß√£o
1. Login com email/username + senha
2. Verifica√ß√£o de credenciais no banco
3. Verifica√ß√£o de aprova√ß√£o (`is_approved = True`)
4. Gera√ß√£o de token JWT
5. Armazenamento em HttpOnly Cookie
6. Middleware de verifica√ß√£o em rotas protegidas

#### Prote√ß√£o de Rotas
- **P√∫blicas**: `/api/login`, `/api/register`, `/health`
- **Autenticadas**: Todas as demais rotas
- **Admin**: `/api/admin/config/*`
- **PCP**: `/api/pcp/*`
- **Gest√£o**: `/api/gestao/*`

### 5.4 üìä Performance e Otimiza√ß√µes

#### Backend
- **Lazy Loading**: Relacionamentos carregados sob demanda
- **Query Optimization**: Joins otimizados com SQLAlchemy
- **Connection Pooling**: Pool de conex√µes SQLite
- **Caching**: Cache de consultas frequentes
- **Pagination**: Implementada em listagens grandes

#### Frontend
- **Code Splitting**: Componentes carregados sob demanda
- **Memoization**: React.memo e useMemo
- **Debouncing**: Em campos de busca
- **Virtual Scrolling**: Para listas grandes
- **Bundle Optimization**: Vite com tree-shaking

### 5.5 üîÑ Integra√ß√£o e APIs

#### Endpoints Principais
- **Base URL**: `http://localhost:8000`
- **Documenta√ß√£o**: `http://localhost:8000/docs` (Swagger)
- **Health Check**: `http://localhost:8000/health`

#### Padr√µes de Response
```json
{
  "success": true,
  "data": {...},
  "message": "Opera√ß√£o realizada com sucesso",
  "timestamp": "2025-01-16T10:30:00Z"
}
```

#### Tratamento de Erros
```json
{
  "detail": "Mensagem de erro",
  "status_code": 400,
  "type": "validation_error"
}
```

### 5.6 üß™ Testes e Qualidade

#### Testes Backend
- **Unit Tests**: Pytest para fun√ß√µes cr√≠ticas
- **Integration Tests**: Testes de endpoints
- **Database Tests**: Testes de modelos SQLAlchemy

#### Testes Frontend
- **Component Tests**: Jest + React Testing Library
- **E2E Tests**: Cypress (planejado)
- **Type Safety**: TypeScript strict mode

#### Qualidade de C√≥digo
- **Linting**: ESLint + Prettier (frontend)
- **Type Checking**: mypy (backend), TypeScript (frontend)
- **Code Coverage**: pytest-cov (backend)

### 5.7 üîÑ Sistema de Processamento Ass√≠ncrono

#### Celery + Redis (Scraping Ass√≠ncrono)
- **Broker**: Redis para fila de tarefas
- **Worker**: Celery worker para processamento
- **Tasks**: `scrape_os_task` com retry autom√°tico
- **Endpoints**:
  - `POST /api/desenvolvimento/buscar-os-async/{numero_os}` - Iniciar scraping
  - `GET /api/desenvolvimento/scraping-status/{task_id}` - Status da task
  - `GET /api/desenvolvimento/queue-status` - Status da fila

#### Funcionalidades Ass√≠ncronas
- **Retry Autom√°tico**: 3 tentativas com backoff exponencial
- **Prioriza√ß√£o**: Usu√°rios com prioridade diferenciada
- **Estimativa de Tempo**: C√°lculo baseado na fila
- **Fallback**: Scraping s√≠ncrono se ass√≠ncrono falhar
- **Progress Tracking**: Acompanhamento em tempo real

#### Middleware de Valida√ß√£o
- **Arquivo**: `middleware/text_validation_middleware.py`
- **Funcionalidade**: Valida√ß√£o autom√°tica de campos de texto
- **Aplica√ß√£o**: Endpoints espec√≠ficos com campos definidos
- **Recursos**: Limpeza de caracteres especiais, valida√ß√£o recursiva

### 5.8 üöÄ Deploy e Ambiente

#### Desenvolvimento
- **Backend**: `uvicorn main:app --reload --port 8000`
- **Frontend**: `npm run dev` (Vite dev server)
- **Database**: SQLite local
- **Redis**: Para tarefas ass√≠ncronas (opcional)
- **Celery**: Worker para processamento ass√≠ncrono

#### Produ√ß√£o (Planejado)
- **Backend**: Docker + Gunicorn
- **Frontend**: Build est√°tico + Nginx
- **Database**: PostgreSQL ou MySQL
- **Redis**: Cluster para alta disponibilidade
- **Celery**: Multiple workers com supervisord
- **Proxy**: Nginx reverse proxy

---

## üîß 6. Detalhes de Implementa√ß√£o Complexos

### 6.1 üîê Sistema de Autentica√ß√£o Hier√°rquico

#### N√≠veis de Privil√©gio
```python
PRIVILEGE_LEVELS = ["ADMIN", "GESTAO", "PCP", "SUPERVISOR", "USER"]
```

#### Funcionalidades
- **has_privilege()**: Verifica√ß√£o hier√°rquica de permiss√µes
- **JWT com HttpOnly Cookies**: Seguran√ßa aprimorada
- **Fallback de Dados**: Campos string como backup para FKs

### 6.2 üõ°Ô∏è Middleware de Valida√ß√£o de Texto

#### Campos Validados
```python
CAMPOS_TEXTO = {
    'nome', 'nome_completo', 'descricao', 'observacao', 'resultado',
    'modelo', 'observacoes', 'titulo', 'comentario', 'detalhes',
    'motivo', 'justificativa', 'anotacoes'
}
```

#### Endpoints com Valida√ß√£o
```python
ENDPOINTS_VALIDACAO = {
    '/api/usuarios', '/api/setores', '/api/equipamentos',
    '/api/clientes', '/api/os', '/api/apontamentos'
}
```

### 6.3 üîÑ Algoritmos de Retry e Prioriza√ß√£o

#### Scraping Ass√≠ncrono
- **Max Retries**: 3 tentativas
- **Backoff**: Exponencial (60 * 2^retry)
- **Prioriza√ß√£o**: Baseada no n√≠vel do usu√°rio
- **Queue Management**: Redis com estimativa de tempo

#### Valida√ß√£o Recursiva
- **Objetos Aninhados**: Valida√ß√£o em profundidade
- **Arrays**: Processamento item por item
- **Fallback**: Continua processamento em caso de erro

### 6.4 üóÑÔ∏è Relacionamentos SQLAlchemy Complexos

#### Multiple Foreign Keys
```python
# ApontamentoDetalhado tem 6 FKs para Usuario
supervisor_aprovacao = Column(Integer, ForeignKey("tipo_usuarios.id"))
criado_por = Column(Integer, ForeignKey("tipo_usuarios.id"))
supervisor_etapa_inicial = Column(Integer, ForeignKey("tipo_usuarios.id"))
supervisor_etapa_parcial = Column(Integer, ForeignKey("tipo_usuarios.id"))
supervisor_etapa_final = Column(Integer, ForeignKey("tipo_usuarios.id"))
```

#### Relacionamentos Bidirecionais
- **back_populates**: Navega√ß√£o reversa autom√°tica
- **foreign_keys**: Especifica√ß√£o expl√≠cita para m√∫ltiplas FKs
- **Lazy Loading**: Otimiza√ß√£o de consultas

### 6.5 üîß Integra√ß√µes Especiais

#### Dynamic Imports
```python
# Importa√ß√£o din√¢mica de m√≥dulos de scraping
scripts_dir = str(script_path.parent)
if scripts_dir not in sys.path:
    sys.path.append(scripts_dir)
from scrape_os_data import execute_scraping
```

#### Path Resolution
- **Resolu√ß√£o Autom√°tica**: Caminhos de scripts din√¢micos
- **Fallback Paths**: M√∫ltiplos caminhos de busca
- **Error Handling**: Tratamento robusto de importa√ß√µes

---

## üìä 7. Estat√≠sticas do Sistema

### 7.1 üìà M√©tricas Principais

- **Total de Endpoints**: ~150 endpoints documentados
- **Tabelas**: 17 tabelas principais mapeadas
- **Relacionamentos**: 60+ relacionamentos documentados
- **Fluxos**: 5 fluxos principais com diagramas
- **Linhas de C√≥digo**: ~20.000 linhas (estimativa)
- **Tecnologias**: 10 tecnologias principais integradas
- **Middleware**: 1 middleware customizado
- **Tasks Ass√≠ncronas**: 1 task principal com retry

### 7.2 üéØ Cobertura da Documenta√ß√£o

- ‚úÖ **Rotas**: 100% dos endpoints documentados
- ‚úÖ **Tabelas**: 100% das tabelas mapeadas (incluindo campos novos)
- ‚úÖ **Relacionamentos**: Todos os FKs documentados
- ‚úÖ **Fluxos**: Principais processos diagramados
- ‚úÖ **Arquitetura**: Stack completo documentado
- ‚úÖ **Funcionalidades Ass√≠ncronas**: Sistema Celery documentado
- ‚úÖ **Middleware**: Valida√ß√£o de texto documentada
- ‚úÖ **Implementa√ß√µes Complexas**: Algoritmos e integra√ß√µes documentados

### 7.3 üîç Campos Adicionados Documentados

#### ApontamentoDetalhado (8 novos campos)
- `categoria_maquina`, `subcategorias_maquina`, `subcategorias_finalizadas`
- `data_finalizacao_subcategorias`, `emprestimo_setor`
- `pendencia`, `pendencia_data`, `resultado_global`

#### TipoMaquina (4 novos campos)
- `subcategoria` (JSON), `especificacoes_tecnicas`
- `campos_teste_resultado`, `setor`, `departamento`

### 7.4 ‚ö° Funcionalidades Ass√≠ncronas Documentadas

- **Scraping Ass√≠ncrono**: Celery + Redis com 3 endpoints
- **Retry Autom√°tico**: Backoff exponencial
- **Queue Management**: Prioriza√ß√£o e estimativa
- **Middleware**: Valida√ß√£o autom√°tica de texto

---

*Documenta√ß√£o 100% alinhada com o c√≥digo fonte do sistema RegistroOS*
*√öltima atualiza√ß√£o: 2025-01-16 - Verifica√ß√£o completa realizada*
*Vers√£o do Sistema: 1.9.0*